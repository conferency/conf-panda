(function(e){var i=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(c,b,a){i.Backbone=e(i,a,c,b)})}else{if(typeof exports!=="undefined"){var g=require("underscore"),j;try{j=require("jquery")}catch(h){}e(i,exports,g,j)}else{i.Backbone=e(i,{},i._,i.jQuery||i.Zepto||i.ender||i.$)}}})(function(y,c,j,u){var p=y.Backbone;var w=Array.prototype.slice;c.VERSION="1.3.3";c.$=u;c.noConflict=function(){y.Backbone=p;return this};c.emulateHTTP=false;c.emulateJSON=false;var S=function(D,G,z){switch(D){case 1:return function(){return j[G](this[z])};case 2:return function(J){return j[G](this[z],J)};case 3:return function(K,J){return j[G](this[z],q(K,this),J)};case 4:return function(L,J,K){return j[G](this[z],q(L,this),J,K)};default:return function(){var J=w.call(arguments);J.unshift(this[z]);return j[G].apply(j,J)}}};var i=function(D,G,z){j.each(G,function(K,J){if(j[J]){D.prototype[J]=S(K,J,z)}})};var q=function(D,z){if(j.isFunction(D)){return D}if(j.isObject(D)&&!z._isModel(D)){return n(D)}if(j.isString(D)){return function(G){return G.get(D)}}return D};var n=function(D){var z=j.matches(D);return function(G){return z(G.attributes)}};var A=c.Events={};var U=/\s+/;var d=function(Q,G,J,D,K){var z=0,L;if(J&&typeof J==="object"){if(D!==void 0&&"context" in K&&K.context===void 0){K.context=D}for(L=j.keys(J);z<L.length;z++){G=d(Q,G,L[z],J[L[z]],K)}}else{if(J&&U.test(J)){for(L=J.split(U);z<L.length;z++){G=Q(G,L[z],D,K)}}else{G=Q(G,J,D,K)}}return G};A.on=function(z,G,D){return aa(this,z,G,D)};var aa=function(z,J,D,K,G){z._events=d(B,z._events||{},J,D,{context:K,ctx:z,listening:G});if(G){var L=z._listeners||(z._listeners={});L[G.id]=G}return z};A.listenTo=function(Q,G,J){if(!Q){return this}var D=Q._listenId||(Q._listenId=j.uniqueId("l"));var K=this._listeningTo||(this._listeningTo={});var z=K[D];if(!z){var L=this._listenId||(this._listenId=j.uniqueId("l"));z=K[D]={obj:Q,objId:D,id:L,listeningTo:K,count:0}}aa(Q,G,J,this,z);return this};var B=function(Q,G,V,J){if(V){var D=Q[G]||(Q[G]=[]);var K=J.context,z=J.ctx,L=J.listening;if(L){L.count++}D.push({callback:V,context:K,ctx:K||z,listening:L})}return Q};A.off=function(z,G,D){if(!this._events){return this}this._events=d(f,this._events,z,G,{context:D,listeners:this._listeners});return this};A.stopListening=function(Q,G,J){var D=this._listeningTo;if(!D){return this}var K=Q?[Q._listenId]:j.keys(D);for(var z=0;z<K.length;z++){var L=D[K[z]];if(!L){break}L.obj.off(G,J,this)}return this};var f=function(G,J,Z,W){if(!G){return}var D=0,ac;var Q=W.context,X=W.listeners;if(!J&&!Z&&!Q){var V=j.keys(X);for(;D<V.length;D++){ac=X[V[D]];delete X[ac.id];delete ac.listeningTo[ac.objId]}return}var K=J?[J]:j.keys(G);for(;D<K.length;D++){J=K[D];var ad=G[J];if(!ad){break}var L=[];for(var z=0;z<ad.length;z++){var Y=ad[z];if(Z&&Z!==Y.callback&&Z!==Y.callback._callback||Q&&Q!==Y.context){L.push(Y)}else{ac=Y.listening;if(ac&&--ac.count===0){delete X[ac.id];delete ac.listeningTo[ac.objId]}}}if(L.length){G[J]=L}else{delete G[J]}}return G};A.once=function(D,J,z){var G=d(r,{},D,J,j.bind(this.off,this));if(typeof D==="string"&&z==null){J=void 0}return this.on(G,J,z)};A.listenToOnce=function(D,J,z){var G=d(r,{},J,z,j.bind(this.stopListening,this,D));return this.listenTo(D,G)};var r=function(D,J,K,G){if(K){var z=D[J]=j.once(function(){G(J,z);K.apply(this,arguments)});z._callback=K}return D};A.trigger=function(z){if(!this._events){return this}var G=Math.max(0,arguments.length-1);var D=Array(G);for(var J=0;J<G;J++){D[J]=arguments[J+1]}d(o,this._events,z,void 0,D);return this};var o=function(z,J,D,K){if(z){var G=z[J];var L=z.all;if(G&&L){L=L.slice()}if(G){R(G,K)}if(L){R(L,[J].concat(K))}}return z};var R=function(Q,G){var V,J=-1,D=Q.length,K=G[0],z=G[1],L=G[2];switch(G.length){case 0:while(++J<D){(V=Q[J]).callback.call(V.ctx)}return;case 1:while(++J<D){(V=Q[J]).callback.call(V.ctx,K)}return;case 2:while(++J<D){(V=Q[J]).callback.call(V.ctx,K,z)}return;case 3:while(++J<D){(V=Q[J]).callback.call(V.ctx,K,z,L)}return;default:while(++J<D){(V=Q[J]).callback.apply(V.ctx,G)}return}};A.bind=A.on;A.unbind=A.off;j.extend(c,A);var H=c.Model=function(D,J){var z=D||{};J||(J={});this.cid=j.uniqueId(this.cidPrefix);this.attributes={};if(J.collection){this.collection=J.collection}if(J.parse){z=this.parse(z,J)||{}}var G=j.result(this,"defaults");z=j.defaults(j.extend({},G,z),G);this.set(z,J);this.changed={};this.initialize.apply(this,arguments)};j.extend(H.prototype,A,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(z){return j.clone(this.attributes)},sync:function(){return c.sync.apply(this,arguments)},get:function(z){return this.attributes[z]},escape:function(z){return j.escape(this.get(z))},has:function(z){return this.get(z)!=null},matches:function(z){return !!j.iteratee(z,this)(this.attributes)},set:function(W,D,X){if(W==null){return this}var Q;if(typeof W==="object"){Q=W;X=D}else{(Q={})[W]=D}X||(X={});if(!this._validate(Q,X)){return false}var G=X.unset;var Z=X.silent;var K=[];var V=this._changing;this._changing=true;if(!V){this._previousAttributes=j.clone(this.attributes);this.changed={}}var L=this.attributes;var Y=this.changed;var ac=this._previousAttributes;for(var J in Q){D=Q[J];if(!j.isEqual(L[J],D)){K.push(J)}if(!j.isEqual(ac[J],D)){Y[J]=D}else{delete Y[J]}G?delete L[J]:L[J]=D}if(this.idAttribute in Q){this.id=this.get(this.idAttribute)}if(!Z){if(K.length){this._pending=X}for(var z=0;z<K.length;z++){this.trigger("change:"+K[z],this,L[K[z]],X)}}if(V){return this}if(!Z){while(this._pending){X=this._pending;this._pending=false;this.trigger("change",this,X)}}this._pending=false;this._changing=false;return this},unset:function(D,z){return this.set(D,void 0,j.extend({},z,{unset:true}))},clear:function(D){var G={};for(var z in this.attributes){G[z]=void 0}return this.set(G,j.extend({},D,{unset:true}))},hasChanged:function(z){if(z==null){return !j.isEmpty(this.changed)}return j.has(this.changed,z)},changedAttributes:function(D){if(!D){return this.hasChanged()?j.clone(this.changed):false}var J=this._changing?this._previousAttributes:this.attributes;var K={};for(var G in D){var z=D[G];if(j.isEqual(J[G],z)){continue}K[G]=z}return j.size(K)?K:false},previous:function(z){if(z==null||!this._previousAttributes){return null}return this._previousAttributes[z]},previousAttributes:function(){return j.clone(this._previousAttributes)},fetch:function(D){D=j.extend({parse:true},D);var G=this;var z=D.success;D.success=function(K){var J=D.parse?G.parse(K,D):K;if(!G.set(J,D)){return false}if(z){z.call(D.context,G,K,D)}G.trigger("sync",G,K,D)};O(this,D);return this.sync("read",this,D)},save:function(D,K,X){var V;if(D==null||typeof D==="object"){V=D;X=K}else{(V={})[D]=K}X=j.extend({validate:true,parse:true},X);var z=X.wait;if(V&&!z){if(!this.set(V,X)){return false}}else{if(!this._validate(V,X)){return false}}var J=this;var L=X.success;var W=this.attributes;X.success=function(Y){J.attributes=W;var Z=X.parse?J.parse(Y,X):Y;if(z){Z=j.extend({},V,Z)}if(Z&&!J.set(Z,X)){return false}if(L){L.call(X.context,J,Y,X)}J.trigger("sync",J,Y,X)};O(this,X);if(V&&z){this.attributes=j.extend({},W,V)}var Q=this.isNew()?"create":X.patch?"patch":"update";if(Q==="patch"&&!X.attrs){X.attrs=V}var G=this.sync(Q,this,X);this.attributes=W;return G},destroy:function(L){L=L?j.clone(L):{};var G=this;var J=L.success;var D=L.wait;var K=function(){G.stopListening();G.trigger("destroy",G,G.collection,L)};L.success=function(Q){if(D){K()}if(J){J.call(L.context,G,Q,L)}if(!G.isNew()){G.trigger("sync",G,Q,L)}};var z=false;if(this.isNew()){j.defer(L.success)}else{O(this,L);z=this.sync("delete",this,L)}if(!D){K()}return z},url:function(){var D=j.result(this,"urlRoot")||j.result(this.collection,"url")||b();if(this.isNew()){return D}var z=this.get(this.idAttribute);return D.replace(/[^\/]$/,"$&/")+encodeURIComponent(z)},parse:function(D,z){return D},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(z){return this._validate({},j.extend({},z,{validate:true}))},_validate:function(D,G){if(!G.validate||!this.validate){return true}D=j.extend({},this.attributes,D);var z=this.validationError=this.validate(D,G)||null;if(!z){return true}this.trigger("invalid",this,z,j.extend(G,{validationError:z}));return false}});var T={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};i(H,T,"attributes");var F=c.Collection=function(D,z){z||(z={});if(z.model){this.model=z.model}if(z.comparator!==void 0){this.comparator=z.comparator}this._reset();this.initialize.apply(this,arguments);if(D){this.reset(D,j.extend({silent:true},z))}};var E={add:true,remove:true,merge:true};var a={add:true,remove:false};var g=function(z,J,D){D=Math.min(Math.max(D,0),z.length);var K=Array(z.length-D);var G=J.length;var L;for(L=0;L<K.length;L++){K[L]=z[L+D]}for(L=0;L<G;L++){z[L+D]=J[L]}for(L=0;L<K.length;L++){z[L+G+D]=K[L]}};j.extend(F.prototype,A,{model:H,initialize:function(){},toJSON:function(z){return this.map(function(D){return D.toJSON(z)})},sync:function(){return c.sync.apply(this,arguments)},add:function(D,z){return this.set(D,j.extend({merge:false},z,a))},remove:function(D,J){J=j.extend({},J);var z=!j.isArray(D);D=z?[D]:D.slice();var G=this._removeModels(D,J);if(!J.silent&&G.length){J.changes={added:[],merged:[],removed:G};this.trigger("update",this,J)}return z?G[0]:G},set:function(Y,K){if(Y==null){return}K=j.extend({},E,K);if(K.parse&&!this._isModel(Y)){Y=this.parse(Y,K)||[]}var af=!j.isArray(Y);Y=af?[Y]:Y.slice();var Z=K.at;if(Z!=null){Z=+Z}if(Z>this.length){Z=this.length}if(Z<0){Z+=this.length+1}var ah=[];var z=[];var V=[];var ad=[];var W={};var ag=K.add;var G=K.merge;var L=K.remove;var J=false;var ai=this.comparator&&Z==null&&K.sort!==false;var Q=j.isString(this.comparator)?this.comparator:null;var ae,X;for(X=0;X<Y.length;X++){ae=Y[X];var ac=this.get(ae);if(ac){if(G&&ae!==ac){var ak=this._isModel(ae)?ae.attributes:ae;if(K.parse){ak=ac.parse(ak,K)}ac.set(ak,K);V.push(ac);if(ai&&!J){J=ac.hasChanged(Q)}}if(!W[ac.cid]){W[ac.cid]=true;ah.push(ac)}Y[X]=ac}else{if(ag){ae=Y[X]=this._prepareModel(ae,K);if(ae){z.push(ae);this._addReference(ae,K);W[ae.cid]=true;ah.push(ae)}}}}if(L){for(X=0;X<this.length;X++){ae=this.models[X];if(!W[ae.cid]){ad.push(ae)}}if(ad.length){this._removeModels(ad,K)}}var D=false;var aj=!ai&&ag&&L;if(ah.length&&aj){D=this.length!==ah.length||j.some(this.models,function(am,al){return am!==ah[al]});this.models.length=0;g(this.models,ah,0);this.length=this.models.length}else{if(z.length){if(ai){J=true}g(this.models,z,Z==null?this.length:Z);this.length=this.models.length}}if(J){this.sort({silent:true})}if(!K.silent){for(X=0;X<z.length;X++){if(Z!=null){K.index=Z+X}ae=z[X];ae.trigger("add",ae,this,K)}if(J||D){this.trigger("sort",this,K)}if(z.length||ad.length||V.length){K.changes={added:z,removed:ad,merged:V};this.trigger("update",this,K)}}return af?Y[0]:Y},reset:function(D,G){G=G?j.clone(G):{};for(var z=0;z<this.models.length;z++){this._removeReference(this.models[z],G)}G.previousModels=this.models;this._reset();D=this.add(D,j.extend({silent:true},G));if(!G.silent){this.trigger("reset",this,G)}return D},push:function(D,z){return this.add(D,j.extend({at:this.length},z))},pop:function(D){var z=this.at(this.length-1);return this.remove(z,D)},unshift:function(D,z){return this.add(D,j.extend({at:0},z))},shift:function(D){var z=this.at(0);return this.remove(z,D)},slice:function(){return w.apply(this.models,arguments)},get:function(z){if(z==null){return void 0}return this._byId[z]||this._byId[this.modelId(z.attributes||z)]||z.cid&&this._byId[z.cid]},has:function(z){return this.get(z)!=null},at:function(z){if(z<0){z+=this.length}return this.models[z]},where:function(D,z){return this[z?"find":"filter"](D)},findWhere:function(z){return this.where(z,true)},sort:function(D){var G=this.comparator;if(!G){throw new Error("Cannot sort a set without a comparator")}D||(D={});var z=G.length;if(j.isFunction(G)){G=j.bind(G,this)}if(z===1||j.isString(G)){this.models=this.sortBy(G)}else{this.models.sort(G)}if(!D.silent){this.trigger("sort",this,D)}return this},pluck:function(z){return this.map(z+"")},fetch:function(D){D=j.extend({parse:true},D);var G=D.success;var z=this;D.success=function(K){var J=D.reset?"reset":"set";z[J](K,D);if(G){G.call(D.context,z,K,D)}z.trigger("sync",z,K,D)};O(this,D);return this.sync("read",this,D)},create:function(D,J){J=J?j.clone(J):{};var K=J.wait;D=this._prepareModel(D,J);if(!D){return false}if(!K){this.add(D,J)}var G=this;var z=J.success;J.success=function(Q,L,V){if(K){G.add(Q,V)}if(z){z.call(V.context,Q,L,V)}};D.save(null,J);return D},parse:function(D,z){return D},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(z){return z[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(D,G){if(this._isModel(D)){if(!D.collection){D.collection=this}return D}G=G?j.clone(G):{};G.collection=this;var z=new this.model(D,G);if(!z.validationError){return z}this.trigger("invalid",this,z.validationError,G);return false},_removeModels:function(L,G){var Q=[];for(var J=0;J<L.length;J++){var D=this.get(L[J]);if(!D){continue}var K=this.indexOf(D);this.models.splice(K,1);this.length--;delete this._byId[D.cid];var z=this.modelId(D.attributes);if(z!=null){delete this._byId[z]}if(!G.silent){G.index=K;D.trigger("remove",D,this,G)}Q.push(D);this._removeReference(D,G)}return Q},_isModel:function(z){return z instanceof H},_addReference:function(z,G){this._byId[z.cid]=z;var D=this.modelId(z.attributes);if(D!=null){this._byId[D]=z}z.on("all",this._onModelEvent,this)},_removeReference:function(z,G){delete this._byId[z.cid];var D=this.modelId(z.attributes);if(D!=null){delete this._byId[D]}if(this===z.collection){delete z.collection}z.off("all",this._onModelEvent,this)},_onModelEvent:function(z,J,D,K){if(J){if((z==="add"||z==="remove")&&D!==this){return}if(z==="destroy"){this.remove(J,K)}if(z==="change"){var G=this.modelId(J.previousAttributes());var L=this.modelId(J.attributes);if(G!==L){if(G!=null){delete this._byId[G]}if(L!=null){this._byId[L]=J}}}}this.trigger.apply(this,arguments)}});var C={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};i(F,C,"models");var l=c.View=function(z){this.cid=j.uniqueId("view");j.extend(this,j.pick(z,v));this._ensureElement();this.initialize.apply(this,arguments)};var I=/^(\S+)\s*(.*)$/;var v=["model","collection","el","id","attributes","className","tagName","events"];j.extend(l.prototype,A,{tagName:"div",$:function(z){return this.$el.find(z)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(z){this.undelegateEvents();this._setElement(z);this.delegateEvents();return this},_setElement:function(z){this.$el=z instanceof c.$?z:c.$(z);this.el=this.$el[0]},delegateEvents:function(D){D||(D=j.result(this,"events"));if(!D){return this}this.undelegateEvents();for(var J in D){var z=D[J];if(!j.isFunction(z)){z=this[z]}if(!z){continue}var G=J.match(I);this.delegate(G[1],G[2],j.bind(z,this))}return this},delegate:function(z,G,D){this.$el.on(z+".delegateEvents"+this.cid,G,D);return this},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(z,G,D){this.$el.off(z+".delegateEvents"+this.cid,G,D);return this},_createElement:function(z){return document.createElement(z)},_ensureElement:function(){if(!this.el){var z=j.extend({},j.result(this,"attributes"));if(this.id){z.id=j.result(this,"id")}if(this.className){z["class"]=j.result(this,"className")}this.setElement(this._createElement(j.result(this,"tagName")));this._setAttributes(z)}else{this.setElement(j.result(this,"el"))}},_setAttributes:function(z){this.$el.attr(z)}});c.sync=function(Q,J,D){var K=e[Q];j.defaults(D||(D={}),{emulateHTTP:c.emulateHTTP,emulateJSON:c.emulateJSON});var V={type:K,dataType:"json"};if(!D.url){V.url=j.result(J,"url")||b()}if(D.data==null&&J&&(Q==="create"||Q==="update"||Q==="patch")){V.contentType="application/json";V.data=JSON.stringify(D.attrs||J.toJSON(D))}if(D.emulateJSON){V.contentType="application/x-www-form-urlencoded";V.data=V.data?{model:V.data}:{}}if(D.emulateHTTP&&(K==="PUT"||K==="DELETE"||K==="PATCH")){V.type="POST";if(D.emulateJSON){V.data._method=K}var L=D.beforeSend;D.beforeSend=function(W){W.setRequestHeader("X-HTTP-Method-Override",K);if(L){return L.apply(this,arguments)}}}if(V.type!=="GET"&&!D.emulateJSON){V.processData=false}var G=D.error;D.error=function(Y,X,W){D.textStatus=X;D.errorThrown=W;if(G){G.call(D.context,Y,X,W)}};var z=D.xhr=c.ajax(j.extend(V,D));J.trigger("request",J,z,D);return z};var e={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};c.ajax=function(){return c.$.ajax.apply(c.$,arguments)};var M=c.Router=function(z){z||(z={});if(z.routes){this.routes=z.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var N=/\((.*?)\)/g;var P=/(\(\?)?:\w+/g;var x=/\*\w+/g;var k=/[\-{}\[\]+?.,\\\^$|#\s]/g;j.extend(M.prototype,A,{initialize:function(){},route:function(D,J,G){if(!j.isRegExp(D)){D=this._routeToRegExp(D)}if(j.isFunction(J)){G=J;J=""}if(!G){G=this[J]}var z=this;c.history.route(D,function(K){var L=z._extractParameters(D,K);if(z.execute(G,L,J)!==false){z.trigger.apply(z,["route:"+J].concat(L));z.trigger("route",J,L);c.history.trigger("route",z,J,L)}});return this},execute:function(z,G,D){if(z){z.apply(this,G)}},navigate:function(z,D){c.history.navigate(z,D);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=j.result(this,"routes");var D,z=j.keys(this.routes);while((D=z.pop())!=null){this.route(D,this.routes[D])}},_routeToRegExp:function(z){z=z.replace(k,"\\$&").replace(N,"(?:$1)?").replace(P,function(D,G){return G?D:"([^/?]+)"}).replace(x,"([^?]*?)");return new RegExp("^"+z+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(D,G){var z=D.exec(G).slice(1);return j.map(z,function(K,J){if(J===z.length-1){return K||null}return K?decodeURIComponent(K):null})}});var m=c.History=function(){this.handlers=[];this.checkUrl=j.bind(this.checkUrl,this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var h=/^[#\/]|\s+$/g;var t=/^\/+|\/+$/g;var ab=/#.*$/;m.started=false;j.extend(m.prototype,A,{interval:50,atRoot:function(){var z=this.location.pathname.replace(/[^\/]$/,"$&/");return z===this.root&&!this.getSearch()},matchRoot:function(){var D=this.decodeFragment(this.location.pathname);var z=D.slice(0,this.root.length-1)+"/";return z===this.root},decodeFragment:function(z){return decodeURI(z.replace(/%25/g,"%2525"))},getSearch:function(){var z=this.location.href.replace(/#.*/,"").match(/\?.+/);return z?z[0]:""},getHash:function(D){var z=(D||this).location.href.match(/#(.*)$/);return z?z[1]:""},getPath:function(){var z=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return z.charAt(0)==="/"?z.slice(1):z},getFragment:function(z){if(z==null){if(this._usePushState||!this._wantsHashChange){z=this.getPath()}else{z=this.getHash()}}return z.replace(h,"")},start:function(D){if(m.started){throw new Error("Backbone.history has already been started")}m.started=true;this.options=j.extend({root:"/"},this.options,D);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange" in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(t,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var J=this.root.slice(0,-1)||"/";this.location.replace(J+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var K=document.body;var G=K.insertBefore(this.iframe,K.firstChild).contentWindow;G.document.open();G.document.close();G.location.hash="#"+this.fragment}var z=window.addEventListener||function(Q,L){return attachEvent("on"+Q,L)};if(this._usePushState){z("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){z("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var z=window.removeEventListener||function(D,G){return detachEvent("on"+D,G)};if(this._usePushState){z("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){z("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}m.started=false},route:function(D,z){this.handlers.unshift({route:D,callback:z})},checkUrl:function(D){var z=this.getFragment();if(z===this.fragment&&this.iframe){z=this.getHash(this.iframe.contentWindow)}if(z===this.fragment){return false}if(this.iframe){this.navigate(z)}this.loadUrl()},loadUrl:function(z){if(!this.matchRoot()){return false}z=this.fragment=this.getFragment(z);return j.some(this.handlers,function(D){if(D.route.test(z)){D.callback(z);return true}})},navigate:function(z,J){if(!m.started){return false}if(!J||J===true){J={trigger:!!J}}z=this.getFragment(z||"");var D=this.root;if(z===""||z.charAt(0)==="?"){D=D.slice(0,-1)||"/"}var K=D+z;z=this.decodeFragment(z.replace(ab,""));if(this.fragment===z){return}this.fragment=z;if(this._usePushState){this.history[J.replace?"replaceState":"pushState"]({},document.title,K)}else{if(this._wantsHashChange){this._updateHash(this.location,z,J.replace);if(this.iframe&&z!==this.getHash(this.iframe.contentWindow)){var G=this.iframe.contentWindow;if(!J.replace){G.document.open();G.document.close()}this._updateHash(G.location,z,J.replace)}}else{return this.location.assign(K)}}if(J.trigger){return this.loadUrl(z)}},_updateHash:function(z,G,D){if(D){var J=z.href.replace(/(javascript:|#).*$/,"");z.replace(J+"#"+G)}else{z.hash="#"+G}}});c.history=new m;var s=function(D,J){var z=this;var G;if(D&&j.has(D,"constructor")){G=D.constructor}else{G=function(){return z.apply(this,arguments)}}j.extend(G,z,J);G.prototype=j.create(z.prototype,D);G.prototype.constructor=G;G.__super__=z.prototype;return G};H.extend=F.extend=M.extend=l.extend=m.extend=s;var b=function(){throw new Error('A "url" property or function must be specified')};var O=function(z,G){var D=G.error;G.error=function(J){if(D){D.call(G.context,z,J,G)}z.trigger("error",z,J,G)}};return c});