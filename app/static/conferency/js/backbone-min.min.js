(function(b){var d=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(e,g,h){d.Backbone=b(d,h,e,g)})}else{if(typeof exports!=="undefined"){var a=require("underscore"),c;try{c=require("jquery")}catch(f){}b(d,exports,a,c)}else{d.Backbone=b(d,{},d._,d.jQuery||d.Zepto||d.ender||d.$)}}})(function(aj,az,av,al){var ap=aj.Backbone;var ak=Array.prototype.slice;az.VERSION="1.3.3";az.$=al;az.noConflict=function(){aj.Backbone=ap;return this};az.emulateHTTP=false;az.emulateJSON=false;var aD=function(a,c,b){switch(a){case 1:return function(){return av[c](this[b])};case 2:return function(d){return av[c](this[b],d)};case 3:return function(d,e){return av[c](this[b],ao(d,this),e)};case 4:return function(d,f,e){return av[c](this[b],ao(d,this),f,e)};default:return function(){var d=ak.call(arguments);d.unshift(this[b]);return av[c].apply(av,d)}}};var aw=function(a,c,b){av.each(c,function(d,f){if(av[f]){a.prototype[f]=aD(d,f,b)}})};var ao=function(a,b){if(av.isFunction(a)){return a}if(av.isObject(a)&&!b._isModel(a)){return ar(a)}if(av.isString(a)){return function(c){return c.get(a)}}return a};var ar=function(a){var b=av.matches(a);return function(c){return b(c.attributes)}};var ai=az.Events={};var aB=/\s+/;var ay=function(c,i,g,j,f){var b=0,d;if(g&&typeof g==="object"){if(j!==void 0&&"context" in f&&f.context===void 0){f.context=j}for(d=av.keys(g);b<d.length;b++){i=ay(c,i,d[b],g[d[b]],f)}}else{if(g&&aB.test(g)){for(d=g.split(aB);b<d.length;b++){i=c(i,d[b],j,f)}}else{i=c(i,g,j,f)}}return i};ai.on=function(b,c,a){return aA(this,b,c,a)};var aA=function(b,f,a,d,g){b._events=ay(ah,b._events||{},f,a,{context:d,ctx:b,listening:g});if(g){var c=b._listeners||(b._listeners={});c[g.id]=g}return b};ai.listenTo=function(c,i,g){if(!c){return this}var j=c._listenId||(c._listenId=av.uniqueId("l"));var f=this._listeningTo||(this._listeningTo={});var b=f[j];if(!b){var d=this._listenId||(this._listenId=av.uniqueId("l"));b=f[j]={obj:c,objId:j,id:d,listeningTo:f,count:0}}aA(c,i,g,this,b);return this};var ah=function(d,k,c,j){if(c){var l=d[k]||(d[k]=[]);var g=j.context,b=j.ctx,f=j.listening;if(f){f.count++}l.push({callback:c,context:g,ctx:g||b,listening:f})}return d};ai.off=function(b,c,a){if(!this._events){return this}this._events=ay(ax,this._events,b,c,{context:a,listeners:this._listeners});return this};ai.stopListening=function(c,i,g){var j=this._listeningTo;if(!j){return this}var f=c?[c._listenId]:av.keys(j);for(var b=0;b<f.length;b++){var d=j[f[b]];if(!d){break}d.obj.off(i,g,this)}return this};var ax=function(B,p,b,i){if(!B){return}var C=0,x;var k=i.context,g=i.listeners;if(!p&&!b&&!k){var j=av.keys(g);for(;C<j.length;C++){x=g[j[C]];delete g[x.id];delete x.listeningTo[x.objId]}return}var A=p?[p]:av.keys(B);for(;C<A.length;C++){p=A[C];var w=B[p];if(!w){break}var m=[];for(var q=0;q<w.length;q++){var y=w[q];if(b&&b!==y.callback&&b!==y.callback._callback||k&&k!==y.context){m.push(y)}else{x=y.listening;if(x&&--x.count===0){delete g[x.id];delete x.listeningTo[x.objId]}}}if(m.length){B[p]=m}else{delete B[p]}}return B};ai.once=function(a,c,b){var d=ay(an,{},a,c,av.bind(this.off,this));if(typeof a==="string"&&b==null){c=void 0}return this.on(d,c,b)};ai.listenToOnce=function(a,c,b){var d=ay(an,{},c,b,av.bind(this.stopListening,this,a));return this.listenTo(a,d)};var an=function(a,d,c,f){if(c){var b=a[d]=av.once(function(){f(d,b);c.apply(this,arguments)});b._callback=c}return a};ai.trigger=function(b){if(!this._events){return this}var d=Math.max(0,arguments.length-1);var a=Array(d);for(var c=0;c<d;c++){a[c]=arguments[c+1]}ay(aq,this._events,b,void 0,a);return this};var aq=function(b,f,a,d){if(b){var g=b[f];var c=b.all;if(g&&c){c=c.slice()}if(g){aE(g,d)}if(c){aE(c,[f].concat(d))}}return b};var aE=function(d,k){var c,j=-1,l=d.length,g=k[0],b=k[1],f=k[2];switch(k.length){case 0:while(++j<l){(c=d[j]).callback.call(c.ctx)}return;case 1:while(++j<l){(c=d[j]).callback.call(c.ctx,g)}return;case 2:while(++j<l){(c=d[j]).callback.call(c.ctx,g,b)}return;case 3:while(++j<l){(c=d[j]).callback.call(c.ctx,g,b,f)}return;default:while(++j<l){(c=d[j]).callback.apply(c.ctx,k)}return}};ai.bind=ai.on;ai.unbind=ai.off;av.extend(az,ai);var ae=az.Model=function(a,c){var b=a||{};c||(c={});this.cid=av.uniqueId(this.cidPrefix);this.attributes={};if(c.collection){this.collection=c.collection}if(c.parse){b=this.parse(b,c)||{}}var d=av.result(this,"defaults");b=av.defaults(av.extend({},d,b),d);this.set(b,c);this.changed={};this.initialize.apply(this,arguments)};av.extend(ae.prototype,ai,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(a){return av.clone(this.attributes)},sync:function(){return az.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return av.escape(this.get(a))},has:function(a){return this.get(a)!=null},matches:function(a){return !!av.iteratee(a,this)(this.attributes)},set:function(y,p,b){if(y==null){return this}var i;if(typeof y==="object"){i=y;b=p}else{(i={})[y]=p}b||(b={});if(!this._validate(i,b)){return false}var A=b.unset;var w=b.silent;var k=[];var g=this._changing;this._changing=true;if(!g){this._previousAttributes=av.clone(this.attributes);this.changed={}}var j=this.attributes;var x=this.changed;var v=this._previousAttributes;for(var m in i){p=i[m];if(!av.isEqual(j[m],p)){k.push(m)}if(!av.isEqual(v[m],p)){x[m]=p}else{delete x[m]}A?delete j[m]:j[m]=p}if(this.idAttribute in i){this.id=this.get(this.idAttribute)}if(!w){if(k.length){this._pending=b}for(var q=0;q<k.length;q++){this.trigger("change:"+k[q],this,j[k[q]],b)}}if(g){return this}if(!w){while(this._pending){b=this._pending;this._pending=false;this.trigger("change",this,b)}}this._pending=false;this._changing=false;return this},unset:function(a,b){return this.set(a,void 0,av.extend({},b,{unset:true}))},clear:function(a){var c={};for(var b in this.attributes){c[b]=void 0}return this.set(c,av.extend({},a,{unset:true}))},hasChanged:function(a){if(a==null){return !av.isEmpty(this.changed)}return av.has(this.changed,a)},changedAttributes:function(a){if(!a){return this.hasChanged()?av.clone(this.changed):false}var d=this._changing?this._previousAttributes:this.attributes;var c={};for(var f in a){var b=a[f];if(av.isEqual(d[f],b)){continue}c[f]=b}return av.size(c)?c:false},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return av.clone(this._previousAttributes)},fetch:function(a){a=av.extend({parse:true},a);var c=this;var b=a.success;a.success=function(d){var e=a.parse?c.parse(d,a):d;if(!c.set(e,a)){return false}if(b){b.call(a.context,c,d,a)}c.trigger("sync",c,d,a)};ab(this,a);return this.sync("read",this,a)},save:function(m,i,b){var d;if(m==null||typeof m==="object"){d=m;b=i}else{(d={})[m]=i}b=av.extend({validate:true,parse:true},b);var p=b.wait;if(d&&!p){if(!this.set(d,b)){return false}}else{if(!this._validate(d,b)){return false}}var j=this;var g=b.success;var c=this.attributes;b.success=function(a){j.attributes=c;var h=b.parse?j.parse(a,b):a;if(p){h=av.extend({},d,h)}if(h&&!j.set(h,b)){return false}if(g){g.call(b.context,j,a,b)}j.trigger("sync",j,a,b)};ab(this,b);if(d&&p){this.attributes=av.extend({},c,d)}var f=this.isNew()?"create":b.patch?"patch":"update";if(f==="patch"&&!b.attrs){b.attrs=d}var k=this.sync(f,this,b);this.attributes=c;return k},destroy:function(c){c=c?av.clone(c):{};var g=this;var f=c.success;var h=c.wait;var d=function(){g.stopListening();g.trigger("destroy",g,g.collection,c)};c.success=function(a){if(h){d()}if(f){f.call(c.context,g,a,c)}if(!g.isNew()){g.trigger("sync",g,a,c)}};var b=false;if(this.isNew()){av.defer(c.success)}else{ab(this,c);b=this.sync("delete",this,c)}if(!h){d()}return b},url:function(){var a=av.result(this,"urlRoot")||av.result(this.collection,"url")||Y();if(this.isNew()){return a}var b=this.get(this.idAttribute);return a.replace(/[^\/]$/,"$&/")+encodeURIComponent(b)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},av.extend({},a,{validate:true}))},_validate:function(a,c){if(!c.validate||!this.validate){return true}a=av.extend({},this.attributes,a);var b=this.validationError=this.validate(a,c)||null;if(!b){return true}this.trigger("invalid",this,b,av.extend(c,{validationError:b}));return false}});var aC={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};aw(ae,aC,"attributes");var af=az.Collection=function(a,b){b||(b={});if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,av.extend({silent:true},b))}};var ag={add:true,remove:true,merge:true};var Z={add:true,remove:false};var W=function(b,f,a){a=Math.min(Math.max(a,0),b.length);var d=Array(b.length-a);var g=f.length;var c;for(c=0;c<d.length;c++){d[c]=b[c+a]}for(c=0;c<g;c++){b[c+a]=f[c]}for(c=0;c<d.length;c++){b[c+g+a]=d[c]}};av.extend(af.prototype,ai,{model:ae,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return az.sync.apply(this,arguments)},add:function(a,b){return this.set(a,av.extend({merge:false},b,Z))},remove:function(a,c){c=av.extend({},c);var b=!av.isArray(a);a=b?[a]:a.slice();var d=this._removeModels(a,c);if(!c.silent&&d.length){c.changes={added:[],merged:[],removed:d};this.trigger("update",this,c)}return b?d[0]:d},set:function(w,P){if(w==null){return}P=av.extend({},ag,P);if(P.parse&&!this._isModel(w)){w=this.parse(w,P)||[]}var B=!av.isArray(w);w=B?[w]:w.slice();var F=P.at;if(F!=null){F=+F}if(F>this.length){F=this.length}if(F<0){F+=this.length+1}var A=[];var U=[];var M=[];var E=[];var I={};var q=P.add;var S=P.merge;var O=P.remove;var R=false;var k=this.comparator&&F==null&&P.sort!==false;var N=av.isString(this.comparator)?this.comparator:null;var C,H;for(H=0;H<w.length;H++){C=w[H];var aF=this.get(C);if(aF){if(S&&C!==aF){var i=this._isModel(C)?C.attributes:C;if(P.parse){i=aF.parse(i,P)}aF.set(i,P);M.push(aF);if(k&&!R){R=aF.hasChanged(N)}}if(!I[aF.cid]){I[aF.cid]=true;A.push(aF)}w[H]=aF}else{if(q){C=w[H]=this._prepareModel(C,P);if(C){U.push(C);this._addReference(C,P);I[C.cid]=true;A.push(C)}}}}if(O){for(H=0;H<this.length;H++){C=this.models[H];if(!I[C.cid]){E.push(C)}}if(E.length){this._removeModels(E,P)}}var T=false;var j=!k&&q&&O;if(A.length&&j){T=this.length!==A.length||av.some(this.models,function(a,b){return a!==A[b]});this.models.length=0;W(this.models,A,0);this.length=this.models.length}else{if(U.length){if(k){R=true}W(this.models,U,F==null?this.length:F);this.length=this.models.length}}if(R){this.sort({silent:true})}if(!P.silent){for(H=0;H<U.length;H++){if(F!=null){P.index=F+H}C=U[H];C.trigger("add",C,this,P)}if(R||T){this.trigger("sort",this,P)}if(U.length||E.length||M.length){P.changes={added:U,removed:E,merged:M};this.trigger("update",this,P)}}return B?w[0]:w},reset:function(a,c){c=c?av.clone(c):{};for(var b=0;b<this.models.length;b++){this._removeReference(this.models[b],c)}c.previousModels=this.models;this._reset();a=this.add(a,av.extend({silent:true},c));if(!c.silent){this.trigger("reset",this,c)}return a},push:function(a,b){return this.add(a,av.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a)},unshift:function(a,b){return this.add(a,av.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a)},slice:function(){return ak.apply(this.models,arguments)},get:function(a){if(a==null){return void 0}return this._byId[a]||this._byId[this.modelId(a.attributes||a)]||a.cid&&this._byId[a.cid]},has:function(a){return this.get(a)!=null},at:function(a){if(a<0){a+=this.length}return this.models[a]},where:function(a,b){return this[b?"find":"filter"](a)},findWhere:function(a){return this.where(a,true)},sort:function(a){var c=this.comparator;if(!c){throw new Error("Cannot sort a set without a comparator")}a||(a={});var b=c.length;if(av.isFunction(c)){c=av.bind(c,this)}if(b===1||av.isString(c)){this.models=this.sortBy(c)}else{this.models.sort(c)}if(!a.silent){this.trigger("sort",this,a)}return this},pluck:function(a){return this.map(a+"")},fetch:function(a){a=av.extend({parse:true},a);var c=a.success;var b=this;a.success=function(d){var e=a.reset?"reset":"set";b[e](d,a);if(c){c.call(a.context,b,d,a)}b.trigger("sync",b,d,a)};ab(this,a);return this.sync("read",this,a)},create:function(a,d){d=d?av.clone(d):{};var c=d.wait;a=this._prepareModel(a,d);if(!a){return false}if(!c){this.add(a,d)}var f=this;var b=d.success;d.success=function(h,j,g){if(c){f.add(h,g)}if(b){b.call(g.context,h,j,g)}};a.save(null,d);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,c){if(this._isModel(a)){if(!a.collection){a.collection=this}return a}c=c?av.clone(c):{};c.collection=this;var b=new this.model(a,c);if(!b.validationError){return b}this.trigger("invalid",this,b.validationError,c);return false},_removeModels:function(d,h){var c=[];for(var g=0;g<d.length;g++){var j=this.get(d[g]);if(!j){continue}var f=this.indexOf(j);this.models.splice(f,1);this.length--;delete this._byId[j.cid];var b=this.modelId(j.attributes);if(b!=null){delete this._byId[b]}if(!h.silent){h.index=f;j.trigger("remove",j,this,h)}c.push(j);this._removeReference(j,h)}return c},_isModel:function(a){return a instanceof ae},_addReference:function(b,c){this._byId[b.cid]=b;var a=this.modelId(b.attributes);if(a!=null){this._byId[a]=b}b.on("all",this._onModelEvent,this)},_removeReference:function(b,c){delete this._byId[b.cid];var a=this.modelId(b.attributes);if(a!=null){delete this._byId[a]}if(this===b.collection){delete b.collection}b.off("all",this._onModelEvent,this)},_onModelEvent:function(b,f,a,d){if(f){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(f,d)}if(b==="change"){var g=this.modelId(f.previousAttributes());var c=this.modelId(f.attributes);if(g!==c){if(g!=null){delete this._byId[g]}if(c!=null){this._byId[c]=f}}}}this.trigger.apply(this,arguments)}});var G={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};aw(af,G,"models");var at=az.View=function(a){this.cid=av.uniqueId("view");av.extend(this,av.pick(a,K));this._ensureElement();this.initialize.apply(this,arguments)};var D=/^(\S+)\s*(.*)$/;var K=["model","collection","el","id","attributes","className","tagName","events"];av.extend(at.prototype,ai,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(a){this.undelegateEvents();this._setElement(a);this.delegateEvents();return this},_setElement:function(a){this.$el=a instanceof az.$?a:az.$(a);this.el=this.$el[0]},delegateEvents:function(a){a||(a=av.result(this,"events"));if(!a){return this}this.undelegateEvents();for(var c in a){var b=a[c];if(!av.isFunction(b)){b=this[b]}if(!b){continue}var d=c.match(D);this.delegate(d[1],d[2],av.bind(b,this))}return this},delegate:function(b,c,a){this.$el.on(b+".delegateEvents"+this.cid,c,a);return this},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(b,c,a){this.$el.off(b+".delegateEvents"+this.cid,c,a);return this},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(!this.el){var a=av.extend({},av.result(this,"attributes"));if(this.id){a.id=av.result(this,"id")}if(this.className){a["class"]=av.result(this,"className")}this.setElement(this._createElement(av.result(this,"tagName")));this._setAttributes(a)}else{this.setElement(av.result(this,"el"))}},_setAttributes:function(a){this.$el.attr(a)}});az.sync=function(d,g,j){var f=X[d];av.defaults(j||(j={}),{emulateHTTP:az.emulateHTTP,emulateJSON:az.emulateJSON});var c={type:f,dataType:"json"};if(!j.url){c.url=av.result(g,"url")||Y()}if(j.data==null&&g&&(d==="create"||d==="update"||d==="patch")){c.contentType="application/json";c.data=JSON.stringify(j.attrs||g.toJSON(j))}if(j.emulateJSON){c.contentType="application/x-www-form-urlencoded";c.data=c.data?{model:c.data}:{}}if(j.emulateHTTP&&(f==="PUT"||f==="DELETE"||f==="PATCH")){c.type="POST";if(j.emulateJSON){c.data._method=f}var e=j.beforeSend;j.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",f);if(e){return e.apply(this,arguments)}}}if(c.type!=="GET"&&!j.emulateJSON){c.processData=false}var i=j.error;j.error=function(h,k,a){j.textStatus=k;j.errorThrown=a;if(i){i.call(j.context,h,k,a)}};var b=j.xhr=az.ajax(av.extend(c,j));g.trigger("request",g,b,j);return b};var X={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};az.ajax=function(){return az.$.ajax.apply(az.$,arguments)};var ad=az.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var ac=/\((.*?)\)/g;var aa=/(\(\?)?:\w+/g;var J=/\*\w+/g;var au=/[\-{}\[\]+?.,\\\^$|#\s]/g;av.extend(ad.prototype,ai,{initialize:function(){},route:function(a,c,d){if(!av.isRegExp(a)){a=this._routeToRegExp(a)}if(av.isFunction(c)){d=c;c=""}if(!d){d=this[c]}var b=this;az.history.route(a,function(f){var e=b._extractParameters(a,f);if(b.execute(d,e,c)!==false){b.trigger.apply(b,["route:"+c].concat(e));b.trigger("route",c,e);az.history.trigger("route",b,c,e)}});return this},execute:function(b,c,a){if(b){b.apply(this,c)}},navigate:function(b,a){az.history.navigate(b,a);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=av.result(this,"routes");var a,b=av.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(au,"\\$&").replace(ac,"(?:$1)?").replace(aa,function(b,c){return c?b:"([^/?]+)"}).replace(J,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,c){var b=a.exec(c).slice(1);return av.map(b,function(d,f){if(f===b.length-1){return d||null}return d?decodeURIComponent(d):null})}});var Q=az.History=function(){this.handlers=[];this.checkUrl=av.bind(this.checkUrl,this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var V=/^[#\/]|\s+$/g;var L=/^\/+|\/+$/g;var z=/#.*$/;Q.started=false;av.extend(Q.prototype,ai,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},matchRoot:function(){var a=this.decodeFragment(this.location.pathname);var b=a.slice(0,this.root.length-1)+"/";return b===this.root},decodeFragment:function(a){return decodeURI(a.replace(/%25/g,"%2525"))},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return a.charAt(0)==="/"?a.slice(1):a},getFragment:function(a){if(a==null){if(this._usePushState||!this._wantsHashChange){a=this.getPath()}else{a=this.getHash()}}return a.replace(V,"")},start:function(a){if(Q.started){throw new Error("Backbone.history has already been started")}Q.started=true;this.options=av.extend({root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange" in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(L,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var d=this.root.slice(0,-1)||"/";this.location.replace(d+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var c=document.body;var f=c.insertBefore(this.iframe,c.firstChild).contentWindow;f.document.open();f.document.close();f.location.hash="#"+this.fragment}var b=window.addEventListener||function(g,h){return attachEvent("on"+g,h)};if(this._usePushState){b("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){b("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var a=window.removeEventListener||function(b,c){return detachEvent("on"+b,c)};if(this._usePushState){a("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){a("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}Q.started=false},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getHash(this.iframe.contentWindow)}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()},loadUrl:function(a){if(!this.matchRoot()){return false}a=this.fragment=this.getFragment(a);return av.some(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(b,d){if(!Q.started){return false}if(!d||d===true){d={trigger:!!d}}b=this.getFragment(b||"");var a=this.root;if(b===""||b.charAt(0)==="?"){a=a.slice(0,-1)||"/"}var c=a+b;b=this.decodeFragment(b.replace(z,""));if(this.fragment===b){return}this.fragment=b;if(this._usePushState){this.history[d.replace?"replaceState":"pushState"]({},document.title,c)}else{if(this._wantsHashChange){this._updateHash(this.location,b,d.replace);if(this.iframe&&b!==this.getHash(this.iframe.contentWindow)){var f=this.iframe.contentWindow;if(!d.replace){f.document.open();f.document.close()}this._updateHash(f.location,b,d.replace)}}else{return this.location.assign(c)}}if(d.trigger){return this.loadUrl(b)}},_updateHash:function(b,d,a){if(a){var c=b.href.replace(/(javascript:|#).*$/,"");b.replace(c+"#"+d)}else{b.hash="#"+d}}});az.history=new Q;var am=function(a,c){var b=this;var d;if(a&&av.has(a,"constructor")){d=a.constructor}else{d=function(){return b.apply(this,arguments)}}av.extend(d,b,c);d.prototype=av.create(b.prototype,a);d.prototype.constructor=d;d.__super__=b.prototype;return d};ae.extend=af.extend=ad.extend=at.extend=Q.extend=am;var Y=function(){throw new Error('A "url" property or function must be specified')};var ab=function(b,c){var a=c.error;c.error=function(d){if(a){a.call(c.context,b,d,c)}b.trigger("error",b,d,c)}};return az});